#!/bin/bash
# http://stackoverflow.com/questions/9084936/using-svn-diff-in-combination-with-vimdiff-to-get-tabbed-diff-page-per-modified

export VIM_SERVERNAME="SVN-$RANDOM"

# Start up a vim, graphical, in the foreground, but backgrounded...
vim -g -f --servername "$VIM_SERVERNAME" &
# So we get can it's PID to wait on later
gvim_pid=$!

# Wait for the server to start up enough
sleep 0.5

# Use svn diff to get the right set of files to pass to vimdiff
svn diff --diff-cmd "vim_tab_diff_helper.py" >/dev/null

# Move to the start of the list; remove the first tab which will be the empty
# tab
vim --servername "$VIM_SERVERNAME" --remote-send ":tabfirst<Return>"
vim --servername "$VIM_SERVERNAME" --remote-send ":bd<Return>"

# Wait for the user to exit vim before returning
wait $gvim_pid
